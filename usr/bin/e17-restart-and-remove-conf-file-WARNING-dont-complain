#!/bin/bash
SOURCE="$0"
source /usr/lib/elive-tools/functions
EL_REPORTS="1"
el_make_environment
. gettext.sh
TEXTDOMAIN="elive-tools"
export TEXTDOMAIN

main(){
    for arg in "$@" ; do
        case "$arg" in

            "--ask")
                if ! zenity --question --text="$( eval_gettext "Do you want to reset your desktop configurations? It will restart your desktop settings to a fresh one. Useful to restore your desktop if you messed up something and you don't know how to recover it." )" ; then
                    exit
                fi

                zenity --info --text="$( eval_gettext "Make sure to close all your running applications correctly before continuing." )"
                ;;
        esac
    done

    # XXX Note: there's a .desktop that references to this (name $0) command, do not break up things
    if [[ -n "$EROOT" ]] ; then
        #killall -9 e16 2>/dev/null
        #rm -fr "$HOME/.e16" "$HOME/.xsession-errors"
        #cd "$HOME"
        #elive-skel upgrade .e16
        #elive-skel upgrade .config/cairo-dock
        # stop all launched applications first
        elive-autostart-applications "stop"
        # freeze E, restore everything, then kill E to restart it
        tmux-attach-jobs background erestart "
        sync ;
        killall -s STOP e16 starte16 efreetd  2>/dev/null ;
        killall -9 cairo-dock 2>/dev/null ;
        killall -9 conky 2>/dev/null ;
        rm -fr \"~/.e16\" \"~/.xsession-errors\" ;
        rm -fr \"~/.config/user-dirs\"* ;
        rm -fr \"~/.config/elive/migrator/\"* ;
        cd ~ ;
        sync ;
        elive-skel upgrade .config/cairo-dock ;
        elive-skel upgrade .conkyrc ;
        killall -9 e16 2>/dev/null ;
        sync ;
        elive-skel upgrade .e16 ;
        "
    fi

    if [[ -n "$E_START" ]] ; then
        #killall -9 enlightenment_start enlightenment ecomorph efreetd 2>/dev/null
        #rm -fr "$HOME/.e" "$HOME/.xsession-errors"
        # stop all launched applications first
        # freeze E, restore everything, then kill E to restart it
        tmux-attach-jobs background erestart "
        sync ;
        killall -s STOP enlightenment_start enlightenment ecomorph efreetd 2>/dev/null ;
        rm -fr \"~/.e\" \"~/.xsession-errors\" ;
        sync ;
        killall -9 enlightenment_start enlightenment ecomorph efreetd 2>/dev/null ;
        "
    fi


    # do a small pause before to continue with anything, because we need to make sure that the confs are removed
    #sleep 20


    #killall -9 Xorg &


    #wait
}

#
#  MAIN
#
main "$@"

# vim: set foldmethod=marker :
